[functions]
  directory = "netlify/functions"

# Security headers applied to all routes
[[headers]]
  for = "/*"
  [headers.values]
    # Prevent browsers from MIME-sniffing away from the declared content type
    X-Content-Type-Options = "nosniff"

    # Prevent this app from being embedded in iframes on other origins
    X-Frame-Options = "SAMEORIGIN"

    # Stop legacy browsers sending the full Referer URL to third parties
    Referrer-Policy = "strict-origin-when-cross-origin"

    # Restrict browser features not used by this app
    Permissions-Policy = "camera=(), microphone=(), geolocation=()"

    # Content Security Policy
    # - script-src: 'unsafe-inline' is required â€” the HTML files contain author-written
    #   inline scripts for GTM init, share-token pre-loading, and UA routing. These are
    #   static, not user data. The XSS risk CSP script-src would normally guard against
    #   is separately addressed by the renderColumns() DOM-API refactor (Finding 1).
    # - connect-src: self + Supabase project + Google Analytics endpoints
    # - img-src: self, data URIs, blob URLs (photo previews), and Supabase storage
    # - style-src: 'unsafe-inline' required by existing extensive inline styles
    # - font-src: self (fonts are self-hosted)
    # - frame-ancestors 'none': prevents clickjacking from any origin
    # - form-action 'self': prevents form submissions to external sites
    Content-Security-Policy = "default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://www.googletagmanager.com; connect-src 'self' https://*.supabase.co https://www.google-analytics.com https://analytics.google.com https://*.google-analytics.com https://*.googletagmanager.com; img-src 'self' data: blob: https://*.supabase.co; style-src 'self' 'unsafe-inline'; font-src 'self' data:; frame-ancestors 'none'; form-action 'self';"
